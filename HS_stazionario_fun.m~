clc
close all; 
clear all; 
close all;
%% Definizione profilo

naca = 'NACA0012';
n = 100;
[xp,yp] = NACA_generator(naca,n,'cos',0); 
% naca = load('64212.mat');
% dummy = size(naca.air,1); dummy = [1,ceil(linspace(2,dummy-1,n*2-3)),dummy];
% xp = naca.air(dummy,1)';
% yp = naca.air(dummy,2)';

fig1 = figure(1);
plot(xp,yp); title('Airfoil'); grid on;

pan = [xp;yp];

Npt  = length(xp);
Npan = length(xp)-1; % numero pannelli

alpha_v = [-2.5:0.5:2.5];
alpha_v = [5,6]
U_mag   = 135;

iter_number = 5000;
 
cp  = nan(size(alpha_v,2),Npan);
DCpHS    = nan(size(alpha_v,2),1); 
DCpFoil  = nan(size(alpha_v,2),1); 
DCpFoilv = nan(size(alpha_v,2),1); 






for av = 1:size(alpha_v,2)

fprintf('alpha = %1.2f deg \n\n',alpha_v(av));

alpha = alpha_v(av)*pi/180; % incidenza profilo
U_inf = U_mag*[cos(alpha) sin(alpha)]; % velocit√† asintotica

[~,A,B,xc,yc,dl,N,T,x] = HS_staz(xp,yp,U_inf);
U_inf_t = U_inf*T;
u_pert = B*x + U_inf_t';

%% Coefficiente di pressione
cp(av,:) = (1-(u_pert./norm(U_inf)).^2)';

DCpHS(av)  = min(cp(av,:) - cp(av,1));

DCpFoil(av)  = min(foil.cp(:,av) - foil.cp(1,av));
DCpFoilv(av) = min(foilv.cp(:,av) - foilv.cp(1,av));


end

% [pol,foil] = xfoil2matlab(coord,alpha,Re,Mach,varargin)
[pol,foil] = xfoil2matlab([xc;yc],alpha_v,0,0,5000);
[polv,foilv] = xfoil2matlab([xc;yc],alpha_v,9000000,0,5000);

for k = 1:size(alpha_v,2)
    figure(k+1);
    plot(foilv.xcp,foilv.cp(:,k),'go-')
    hold on
    plot(foil.xcp,foil.cp(:,k),'bo-')
    plot(xc,cp(k,:),'ro-')
    grid on;
    set(gca,'YDir','Reverse'); % reverse y axis
    alfa=num2str(alpha*180/pi);
    tit1 = 'COEFFICIENTE DI PRESSIONE';
    tit2 = ['Incidenza: ',alfa, ' gradi'];
    title({tit1;tit2})
    legend('xfoil_v','xfoil_i','HS')
    xlabel('corda');
    ylabel('-C_p');
end

% % % 
% % % figure(av*3 -2)
% % % axis equal
% % % hold on
% % % plot(xp,yp,'Color',[0 0.5 1],'LineWidth',2);
% % % plot(xc,yc,'xr','LineWidth',2);
% % % 
% % % figure(3*av-1)
% % % n = length(xc)/2; 
% % % hold on
% % % plot(xc(1:n),cp(1:n),'Color',[0 0.5 1],'LineWidth',2);
% % % plot(xc(n:end),cp(n:end),'Color',[1 0.5 0],'LineWidth',2);
% % % grid on
% % % set(gca,'YDir','Reverse'); % reverse y axis
% % % alfa=num2str(alpha*180/pi);
% % % tit1 = 'COEFFICIENTE DI PRESSIONE';
% % % tit2 = ['Incidenza: ',alfa, ' gradi'];
% % % title({tit1;tit2})
% % % legend('dwn','up')
% % % xlabel('corda');
% % % ylabel('-C_p');
% % % 
% % % %plot(alpha_v,abs(DCp))